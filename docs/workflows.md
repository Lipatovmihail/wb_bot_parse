# –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –≤–æ—Ä–∫—Ñ–ª–æ—É WB API

–ù–∏–∂–µ –∫—Ä–∞—Ç–∫–æ –æ–ø–∏—Å–∞–Ω—ã —ç—Ç–∞–ø—ã –∫–∞–∂–¥–æ–≥–æ –∏–∑ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –≤–æ—Ä–∫—Ñ–ª–æ—É, —á—Ç–æ–±—ã –±—ã–ª–æ –ø—Ä–æ—â–µ –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è –≤ –ª–æ–≥–∏–∫–µ –±–æ—Ç–∞.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –¥–ª—è –Ω–æ–≤–æ–π —Å–µ—Å—Å–∏–∏

**–û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª**: `wb_min_bot.py` (–æ–∫–æ–ª–æ 4706 —Å—Ç—Ä–æ–∫)

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞**:
- `wb_min_bot.py` ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç –±–æ—Ç–∞
- `docs/workflows.md` ‚Äî —ç—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- `json n8n/` ‚Äî JSON-—Ñ–∞–π–ª—ã –≤–æ—Ä–∫—Ñ–ª–æ—É –∏–∑ n8n (—Å–ø—Ä–∞–≤–æ—á–Ω—ã–µ)
- `requirements.txt` ‚Äî –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Python
- `Dockerfile` ‚Äî –æ–±—Ä–∞–∑ –¥–ª—è Docker

**–ó–∞–ø—É—Å–∫/–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–æ—Ç–∞**:
```bash
cd /Users/mihaillipatov/n8n-rnp
docker compose build wb-min-bot
docker compose up -d wb-min-bot
docker compose logs --tail=100 wb-min-bot  # –ø—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
```

**–í–∞–∂–Ω—ã–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã** (–≤ –Ω–∞—á–∞–ª–µ `wb_min_bot.py`):
- `AD_STATS_RATE_INTERVAL_SECONDS = 30` ‚Äî –ø–∞—É–∑–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏ ad stats
- `AD_STATS_RIGHT_COOLDOWN_MINUTES = 30` ‚Äî –∫—É–ª–¥–∞—É–Ω –¥–ª—è right —Å—Ç–∞—Ç—É—Å–∞
- `AD_STATS_MAX_RETRIES = 5` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–≤—Ç–æ—Ä–æ–≤ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- `AD_STATS_RETRY_BASE_DELAY_SECONDS = 30` ‚Äî –±–∞–∑–æ–≤–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è —Ä–µ—Ç—Ä–∞–µ–≤
- `AD_EXPENSES_RATE_INTERVAL_SECONDS = 1` ‚Äî –ø–∞—É–∑–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏ ad expenses (1 –∑–∞–ø—Ä–æ—Å/—Å–µ–∫)
- `AD_EXPENSES_CHUNK_DELAY_SECONDS = 2` ‚Äî –∑–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É —á–∞–Ω–∫–∞–º–∏ ad expenses
- `AD_EXPENSES_RIGHT_COOLDOWN_MINUTES = 30` ‚Äî –∫—É–ª–¥–∞—É–Ω –¥–ª—è right —Å—Ç–∞—Ç—É—Å–∞ ad expenses
- `AD_EXPENSES_MAX_RETRIES = 5` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–≤—Ç–æ—Ä–æ–≤ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö ad expenses
- `AD_EXPENSES_RETRY_BASE_DELAY_SECONDS = 5` ‚Äî –±–∞–∑–æ–≤–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è —Ä–µ—Ç—Ä–∞–µ–≤ ad expenses (–Ω–∞—Ä–∞—Å—Ç–∞—é—â–∞—è)

## 01. Orders

- **–¶–µ–ª—å**: —Å–æ–±—Ä–∞—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –∑–∞–∫–∞–∑—ã –∏–∑ WB –∏ –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏—Ö –≤ —Ç–∞–±–ª–∏—Ü—É `WB_orders`, –æ–±–Ω–æ–≤–∏–≤ —Å—Ç–∞—Ç—É—Å —Å–µ–ª–ª–µ—Ä–æ–≤.

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ–ª–ª–µ—Ä–æ–≤
- –ë–µ—Ä—ë–º –≤—Å–µ—Ö —Å–µ–ª–ª–µ—Ä–æ–≤ —Å `in_workrnp = 1`.
- –ü–∞—Ä—Å–∏–º `orders_status`; —Å–æ–∑–¥–∞—ë–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã:
  - `new` ‚Äî –±–µ–∑ —Å—Ç–∞—Ç—É—Å–∞, –≤—ã–≥—Ä—É–∂–∞–µ–º —Å—Ä–∞–∑—É.
  - `left/right` ‚Äî –ø—Ä–∏–º–µ–Ω—è–µ–º –ª–æ–≥–∏–∫–∞ –∫—É–ª–¥–∞—É–Ω–∞ (30 –º–∏–Ω—É—Ç –¥–ª—è `right`), –≤—ã–±–∏—Ä–∞–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã—Ö.
- –í Telegram —É—Ö–æ–¥–∏—Ç —Å–≤–æ–¥–∫–∞ —Å –æ—Ç–º–µ—Ç–∫–∞–º–∏, –∫—Ç–æ —Ä–∞–∑—Ä–µ—à—ë–Ω.

### 2. –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö
- –î–ª—è —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã—Ö —Å–µ–ª–ª–µ—Ä–æ–≤ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –≤—ã–∑—ã–≤–∞–µ–º:  
  `GET https://statistics-api.wildberries.ru/api/v1/supplier/orders`  
  –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: `dateFrom` (–ø–æ–¥–æ–±—Ä–∞–Ω–Ω—ã–π –Ω–∞ –ø–µ—Ä–≤–æ–º —ç—Ç–∞–ø–µ), —Ö–µ–¥–µ—Ä—ã `User-Agent`, `Authorization: Bearer <token>`.
- –û—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä—É–µ–º –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ Telegram.

### 3. –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞
- –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º JSON –∫ –ø–ª–æ—Å–∫–æ–º—É —Å–ø–∏—Å–∫—É, –ø–∏—à–µ–º CSV `WB_orders_import.csv`.
- `LOAD DATA INFILE` -> `WB_orders`.

### 4. –°—Ç–∞—Ç—É—Å
- –û–±–Ω–æ–≤–ª—è–µ–º `orders_status` –≤ `WB_sellers_updates`, —Ñ–∏–∫—Å–∏—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ Telegram.

## 02. Sales

- **–¶–µ–ª—å**: —Å–æ–±—Ä–∞—Ç—å –ø—Ä–æ–¥–∞–∂–∏ —Å–µ–ª–ª–µ—Ä–æ–≤ –≤ `WB_sales`, –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å.

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ–ª–ª–µ—Ä–æ–≤
- –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –∑–∞–∫–∞–∑–∞–º: —á–∏—Ç–∞–µ–º `sales_status`, –ø—Ä–∏–º–µ–Ω—è–µ–º –∫—É–ª–¥–∞—É–Ω—ã (`right` ‚Äî 30 –º–∏–Ω—É—Ç).
- –í Telegram –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç–∞–±–ª–∏—Ü—É –≤—ã–±–æ—Ä–∞.

### 2. –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö
- `GET https://statistics-api.wildberries.ru/api/v1/supplier/sales`
- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: `dateFrom` –≤ query. –•–µ–¥–µ—Ä—ã —Ç–µ –∂–µ, —á—Ç–æ –∏ –≤ orders.

### 3. CSV –∏ –∑–∞–≥—Ä—É–∑–∫–∞
- –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è -> `WB_sales_import.csv`.
- `LOAD DATA INFILE` –≤ `WB_sales`.

### 4. –°—Ç–∞—Ç—É—Å
- `update_sales_status` –≤—ã—á–∏—Å–ª—è–µ—Ç –Ω–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (–≤–∫–ª—é—á–∞—è –≥—Ä–∞–Ω–∏—Ü—ã –¥–∞—Ç, —Å—Ç–∞—Ç—É—Å `right/left`).
- –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∏—Ç–æ–≥–∏ –≤ Telegram.

## 03. Products

- **–¶–µ–ª—å**: –≤—ã–≥—Ä—É–∑–∏—Ç—å –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ –∏ –æ–±–Ω–æ–≤–∏—Ç—å `products_status`.

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ–ª–ª–µ—Ä–æ–≤
- –ß–∏—Ç–∞–µ–º `products_status`. –ù–æ–≤–∏—á–∫–æ–≤ –±–µ—Ä—ë–º —Å—Ä–∞–∑—É, –æ—Å—Ç–∞–ª—å–Ω—ã–µ ‚Äî –ø–æ –∫—É–ª–¥–∞—É–Ω—É (60 –º–∏–Ω—É—Ç).
- –ï—Å–ª–∏ —Å–µ–ª–ª–µ—Ä –≤ –∫—É–ª–¥–∞—É–Ω–µ, –ø–∏—à–µ–º –≤ –ª–æ–≥–∏ ¬´–û—Ç–ª–æ–∂–∏–ª–∏‚Ä¶¬ª.
- –í—ã–±–æ—Ä–∫–∞ –ø—É–±–ª–∏–∫—É–µ—Ç—Å—è –≤ Telegram.

### 2. –°–±–æ—Ä –∫–∞—Ä—Ç–æ—á–µ–∫
- `POST/GET https://content-api.wildberries.ru/content/v2/get/cards/list` (–∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ–∫—É—â—É—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é `fetch_products_for_seller` —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π).
- –î–ª—è –∫–∞–∂–¥–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏ —Å–æ–±–∏—Ä–∞–µ–º —Ä–∞–∑–º–µ—Ä—ã, —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏, —Ñ–æ—Ç–æ.
- –û—à–∏–±–∫–∏ Telegram-–æ–ø–æ–≤–µ—â–µ–Ω–∏–µ–º.

### 3. CSV –∏ –∑–∞–≥—Ä—É–∑–∫–∞
- `WB_products_import.csv` —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–º–∏ –ø–æ–ª—è–º–∏ (`nmID`, `imtID`, `description`, `skus` –∏ —Ç.–¥.).
- `LOAD DATA INFILE` –≤ `WB_products`.

### 4. –°—Ç–∞—Ç—É—Å
- `update_products_status` —Å—á–∏—Ç–∞–µ—Ç:
  - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö `nmID`, `imtID`, `subjectName`, `brand`, `video`,
  - —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ `skus`, `needKiz`, –≤–∞–ª–∏–¥–Ω—ã–µ –≥–∞–±–∞—Ä–∏—Ç—ã.
- –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `products_status` (`WB_sellers_updates`) –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ Telegram.

## 04. Ad List

- **–¶–µ–ª—å**: –ø–æ–ª—É—á–∏—Ç—å –ø–µ—Ä–µ—á–µ–Ω—å —Ä–µ–∫–ª–∞–º–Ω—ã—Ö –∫–∞–º–ø–∞–Ω–∏–π, –∑–∞–≥—Ä—É–∑–∏—Ç—å –≤ `WB_ad_campaigns`, —Ö—Ä–∞–Ω–∏—Ç—å –∫—Ä–∞—Ç–∫–∏–π —Å—Ç–∞—Ç—É—Å –ø–æ —Å–µ–ª–ª–µ—Ä—É.

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ–ª–ª–µ—Ä–æ–≤
- –ß–∏—Ç–∞–µ–º `ad_list_status`, —É—á–∏—Ç—ã–≤–∞–µ–º –∫—É–ª–¥–∞—É–Ω (`ADS_COOLDOWN_MINUTES`, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 60 –º–∏–Ω).
- –û—Ç—Å—ã–ª–∞–µ–º —Å–≤–æ–¥–∫—É –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–µ–ª–ª–µ—Ä–∞—Ö, –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö –Ω–∞ –æ–∂–∏–¥–∞–Ω–∏–µ.

### 2. –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö
- `GET https://advert-api.wildberries.ru/adv/v1/promotion/count`
- WB –æ—Ç–¥–∞—ë—Ç –º–∞—Å—Å–∏–≤ –±–ª–æ–∫–æ–≤ `adverts`: –∫–∞–∂–¥—ã–π —Å–æ–¥–µ—Ä–∂–∏—Ç `type`, `status`, `count`, `advert_list`.
- –ú—ã —Å—É–º–º–∏—Ä—É–µ–º `count`, –æ—Ç–¥–µ–ª—å–Ω–æ —Å—á–∏—Ç–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ (`status == 9`) –∏ –Ω–∞ –ø–∞—É–∑–µ (`status == 11`).
- –ü–æ–±–æ—á–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç: —Ñ–æ—Ä–º–∏—Ä—É–µ–º –ø–ª–æ—Å–∫–∏–µ —Å—Ç—Ä–æ–∫–∏ —Å `advertId`, `changeTime` (–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π), `type`, `status`, `seller_id`.

### 3. CSV –∏ –∑–∞–≥—Ä—É–∑–∫–∞
- `WB_ad_list_import.csv` -> `LOAD DATA INFILE` -> `WB_ad_campaigns`.
- –û—à–∏–±–∫–∏ —Ñ–∏–∫—Å–∏—Ä—É—é—Ç—Å—è –∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ Telegram.

### 4. –°—Ç–∞—Ç—É—Å
- `update_ad_list_status` –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç JSON:
  ```json
  {
    "nowTime": "YYYY-MM-DD HH:MM:SS",
    "ad_all_cnt": <–≤—Å–µ–≥–æ>,
    "ad_active_cnt": <status=9>,
    "ad_paused_cnt": <status=11>
  }
  ```
- –°—Ç–∞—Ç—É—Å —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `WB_sellers_updates` –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ Telegram —Å–≤–æ–¥–∫–æ–π `all/active/paused`.

## 05. Ad Stats

- **–¶–µ–ª—å**: —Å–æ–±—Ä–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ —Ä–µ–∫–ª–∞–º–Ω—ã–º –∫–∞–º–ø–∞–Ω–∏—è–º (–ø–æ –¥–Ω—è–º –∏ –ø–ª–æ—â–∞–¥–∫–∞–º) –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ —Ç–∞–±–ª–∏—Ü—É `WB_ad_stats`, –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Å–µ–ª–ª–µ—Ä–æ–≤.

### ‚ö†Ô∏è –í–ê–ñ–ù–û: –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã WB_ad_stats

- **–£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–ª—é—á**: `seller_advert_date_key` = `seller_id` + `advert_id` + `nmId` + `date` + `appType`
  - –ü—Ä–∏–º–µ—Ä: `782d8c6632e92_27876425_259774399_2025-11-12_64`
- **–ö–æ–ª–æ–Ω–∫–∏ –≤ –ë–î** (snake_case, –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è LOAD DATA INFILE):
  - `advert_id` (–ù–ï `advertId`!)
  - `app_type` (–ù–ï `appType`!)
  - `nmID` (—Å –±–æ–ª—å—à–æ–π D)
- **–£–¥–∞–ª–µ–Ω—ã –∫–æ–ª–æ–Ω–∫–∏**: `brand` –∏ `name` ‚Äî –∏—Ö –Ω–µ—Ç –≤ —Ç–∞–±–ª–∏—Ü–µ
- **–ü–æ–ª–µ —Ä–∞—Å—Ö–æ–¥–æ–≤**: `ad_expenses` (–≤ CSV —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –∏–∑ `sum` –∏–∑ API)

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ–ª–ª–µ—Ä–æ–≤
- SQL-–∑–∞–ø—Ä–æ—Å –±–µ—Ä—ë—Ç `ad_stats_status` –∏ —Å–ø–∏—Å–æ–∫ –∫–∞–º–ø–∞–Ω–∏–π (`WB_ad_campaigns`).
- –†–∞–∑—Ä–µ—à–µ–Ω—ã —Ç–æ–ª—å–∫–æ –∫–∞–º–ø–∞–Ω–∏–∏ –≤ —Å—Ç–∞—Ç—É—Å–∞—Ö `7`, `9`, `11`.
- **–õ–æ–≥–∏–∫–∞ —Å—Ç–∞—Ç—É—Å–æ–≤** (–í–ê–ñ–ù–û: –Ω–µ—Ç —Å—Ç–∞—Ç—É—Å–∞ `true`, —Ç–æ–ª—å–∫–æ `left` –∏ `right`):
  - `new` ‚Äî —Å–µ–ª–ª–µ—Ä –±–µ–∑ —Å—Ç–∞—Ç—É—Å–∞, –≤—ã–≥—Ä—É–∂–∞–µ–º —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ–¥–Ω–∏–µ 15 –¥–Ω–µ–π, –ø—Ä–∏—Å–≤–∞–∏–≤–∞–µ–º `left`
  - `left` ‚Äî –Ω–æ–≤–∏—á–æ–∫, –∫–æ–ø–∞–µ–º –≤ –≥–ª—É–±–∏–Ω—É –¥–æ 180 –¥–Ω–µ–π –Ω–∞–∑–∞–¥ –æ—Ç —Å–µ–≥–æ–¥–Ω—è
  - `right` ‚Äî —Å–µ–ª–ª–µ—Ä –ø—Ä–æ—à—ë–ª –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–¥–≤–∏–≥–∞–µ–º—Å—è –≤–ø–µ—Ä—ë–¥)
- **–ö—É–ª–¥–∞—É–Ω—ã**:
  - `new` ‚Äî —Å—Ä–∞–∑—É
  - `left` ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π `nowTime` –∏–∑ –≥—Ä—É–ø–ø—ã
  - `right` ‚Äî **30 –º–∏–Ω—É—Ç** (`AD_STATS_RIGHT_COOLDOWN_MINUTES = 30`)
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å**: –µ—Å–ª–∏ —É —Å–µ–ª–ª–µ—Ä–∞ 0 —Ä–µ–∫–ª–∞–º–Ω—ã—Ö –∫–∞–º–ø–∞–Ω–∏–π ‚Äî —Å—Ä–∞–∑—É —Å—Ç–∞–≤–∏–º —Å—Ç–∞—Ç—É—Å `right` (–Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º)
- Telegram –ø–æ–ª—É—á–∞–µ—Ç —Å–≤–æ–¥–∫—É —Å:
  - –ú–∏–Ω—É—Ç–∞–º–∏ —Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ø—Ä–æ–≥–æ–Ω–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `18min |`)
  - –ú–∏–Ω/–º–∞–∫—Å –≥—Ä–∞–Ω–∏—Ü–∞–º–∏ –¥–∞—Ç –∏–∑ –≤—Å–µ—Ö —á–∞–Ω–∫–æ–≤ (–Ω–µ —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª)
  - –û—Ç–º–µ—Ç–∫–∞–º–∏ –¥–æ–ø—É—Å–∫–∞ (‚úÖ/‚úñÔ∏è)

### 2. –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤
- –î–∏–∞–ø–∞–∑–æ–Ω: –º–∞–∫—Å–∏–º—É–º 180 –¥–Ω–µ–π –Ω–∞–∑–∞–¥, –∏–Ω—Ç–µ—Ä–≤–∞–ª ‚Äî –¥–æ 31 –¥–Ω—è.
- –ö–∞–º–ø–∞–Ω–∏–∏ —Ä–µ–∂—É—Ç—Å—è –ø–∞—á–∫–∞–º–∏ –ø–æ 100 ID (`AD_STATS_MAX_CAMPAIGNS_PER_REQUEST = 100`).
- –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è `ready_at`: 3 –∑–∞–ø—Ä–æ—Å–∞/–º–∏–Ω—É—Ç—É, –ø–∞—É–∑–∞ **30 —Å–µ–∫** (`AD_STATS_RATE_INTERVAL_SECONDS = 30`).
- –ü–ª–∞–Ω —Å–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –ø–æ –≤—Ä–µ–º–µ–Ω–∏, —á—Ç–æ–±—ã —Å–µ–ª–ª–µ—Ä—ã –Ω–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–∏ –¥—Ä—É–≥ –¥—Ä—É–≥–∞.
- –í Telegram –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Ä–µ–∑—é–º–µ: **–¥–æ 50 —Å—Ç—Ä–æ–∫** –ø–ª–∞–Ω–∞ (–Ω–µ 10!), –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤, –ø–µ—Ä–≤—ã–µ —Å—Ç—Ä–æ–∫–∏ —Å –±—Ä–µ–Ω–¥–∞–º–∏.

### 3. –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤
- –ó–∞–ø—Ä–æ—Å: `GET https://advert-api.wildberries.ru/adv/v3/fullstats` (`beginDate`, `endDate`, `ids`).
- –ü–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º –±–æ—Ç –∂–¥—ë—Ç –¥–æ –ø–ª–∞–Ω–æ–≤–æ–≥–æ `ready_at` + –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ 30 —Å–µ–∫ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏ –æ–¥–Ω–æ–≥–æ —Å–µ–ª–ª–µ—Ä–∞.
- **–†–µ—Ç—Ä–∞–∏**: –¥–æ 5 –ø–æ–ø—ã—Ç–æ–∫ –¥–ª—è –æ—à–∏–±–æ–∫ 429/500 —Å –Ω–∞—Ä–∞—Å—Ç–∞—é—â–µ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π (30, 60, 90, 120, 150 —Å–µ–∫)
- –†–µ–∑—É–ª—å—Ç–∞—Ç —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç—Å—è: –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –∫–∞–º–ø–∞–Ω–∏–∏ –±–µ–∑ `days`, –ø–æ –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–µ `nm` —Ñ–æ—Ä–º–∏—Ä—É–µ–º –∞–≥—Ä–µ–≥–∞—Ç:
  - `views`, `clicks`, `ctr`, `cpc`, `atbs`, `orders`, `shks`, `cr`, `canceled`, `sum`, `sum_price`
  - `ad_expenses` = `sum` (—Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ —Ä–µ–∫–ª–∞–º—É)
  - `avg_position` –∏–∑ `boosterStats`
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞**: –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫ `[WB-bot] Ad Stats: –∑–∞–ø—Ä–æ—Å X/Y | brand | chunk...`
- –û—à–∏–±–∫–∏ –∞–∫–∫—É–º—É–ª–∏—Ä—É—é—Ç—Å—è –∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º.

### 4. CSV –∏ –∑–∞–≥—Ä—É–∑–∫–∞ –≤ –ë–î
- –ü–∏—à–µ–º `WB_ad_stats_import.csv` —Å –∫–æ–ª–æ–Ω–∫–∞–º–∏ (–≤ –ø–æ—Ä—è–¥–∫–µ!):
  - `seller_advert_date_key`, `seller_id`, `advertId` (–≤ CSV), `date`, `nmId`, `appType` (–≤ CSV)
  - `views`, `clicks`, `ctr`, `cpc`, `ad_expenses`, `atbs`, `orders`, `shks`, `cr`, `canceled`, `sum`, `sum_price`, `avg_position`
- **LOAD DATA INFILE** –≤ `WB_ad_stats` —Å –º–∞–ø–ø–∏–Ω–≥–æ–º:
  - CSV `advertId` ‚Üí –ë–î `advert_id`
  - CSV `nmId` ‚Üí –ë–î `nmID` (—Å –±–æ–ª—å—à–æ–π D)
  - CSV `appType` ‚Üí –ë–î `app_type`
- ‚ö†Ô∏è **–ö–†–ò–¢–ò–ß–ù–û**: –°—Ç–∞—Ç—É—Å—ã –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è **–¢–û–õ–¨–ö–û** –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –≤ –ë–î. –ï—Å–ª–∏ –∑–∞–≥—Ä—É–∑–∫–∞ –Ω–µ –ø—Ä–æ—à–ª–∞ ‚Äî —Å—Ç–∞—Ç—É—Å—ã –ù–ï –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è.

### 5. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤
- **–õ–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫**:
  - –ï—Å–ª–∏ –≤—Å–µ —á–∞–Ω–∫–∏ —Å–µ–ª–ª–µ—Ä–∞ –≤–µ—Ä–Ω—É–ª–∏ –æ—à–∏–±–∫—É –æ—Ç WB ‚Äî —Å—Ç–∞—Ç—É—Å –ù–ï –º–µ–Ω—è–µ—Ç—Å—è (–æ—Å—Ç–∞–≤–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π)
  - –ï—Å–ª–∏ –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã —É—Å–ø–µ—à–Ω—ã, –Ω–æ –ø—É—Å—Ç—ã–µ (–Ω–µ—Ç —Å—Ç—Ä–æ–∫) ‚Äî —Å—Ç–∞—Ç—É—Å `right` (–Ω–æ–≤–∏—á–æ–∫ –±–µ–∑ –¥–∞–Ω–Ω—ã—Ö)
- **–§–æ—Ä–º–∞—Ç —Å—Ç–∞—Ç—É—Å–∞**:
  ```json
  {
    "status": "left" | "right",
    "nowTime": "YYYY-MM-DD HH:MM:SS",
    "lastTotalRow": <–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫>,
    "leftBoundary": "YYYY-MM-DD",
    "maxBeginDate": "YYYY-MM-DD",
    "lastBeginDate": "YYYY-MM-DD",
    "rightBoundary": "YYYY-MM-DD"
  }
  ```
- **–í—ã—á–∏—Å–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞**:
  - `maxBeginDate` = min(—Å—Ç–∞—Ä—ã–π `maxBeginDate`, —Ç–µ–∫—É—â–∏–π `beginDate` –∏–∑ —É—Å–ø–µ—à–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤)
  - `leftBoundary` / `rightBoundary` = –º–∏–Ω/–º–∞–∫—Å –¥–∞—Ç—ã –∏–∑ —Å—Ç—Ä–æ–∫ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
  - `status` = `right` –µ—Å–ª–∏ —Å—Ç–∞—Ä—ã–π —É–∂–µ `right` –ò–õ–ò —Ç–µ–∫—É—â–∏–π `beginDate` <= (—Å–µ–≥–æ–¥–Ω—è - 180 –¥–Ω–µ–π)
- Telegram-—Å–≤–æ–¥–∫–∞ –ø–æ –∏—Ç–æ–≥–∞–º: —Å–∫–æ–ª—å–∫–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤—ã–ø–æ–ª–Ω–∏–ª–æ—Å—å/–ø—É—Å—Ç—ã—Ö, —Å–∫–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ –∫–∞–∂–¥–æ–º—É –±—Ä–µ–Ω–¥—É, –ø–µ—Ä–µ—Ö–æ–¥—ã —Å—Ç–∞—Ç—É—Å–æ–≤.

## 06. Ad Expenses

- **–¶–µ–ª—å**: —Å–æ–±—Ä–∞—Ç—å —Å–ø–∏—Å–∞–Ω–∏—è –í–ë –∑–∞ —Ä–µ–∫–ª–∞–º—É (—Ä–∞—Å—Ö–æ–¥—ã –ø–æ —Ä–µ–∫–ª–∞–º–Ω—ã–º –∫–∞–º–ø–∞–Ω–∏—è–º) –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ —Ç–∞–±–ª–∏—Ü—É `WB_ad_expenses`, –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Å–µ–ª–ª–µ—Ä–æ–≤.

### ‚ö†Ô∏è –í–ê–ñ–ù–û: –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã WB_ad_expenses

- **–£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–ª—é—á**: `seller_advert_date_key` = `seller_id` + `advertId` + `date` + `paymentType`
  - –ü—Ä–∏–º–µ—Ä: `782d8c6632e92_27876425_2025-11-12_1`
- **–ê–≥—Ä–µ–≥–∞—Ü–∏—è**: –µ—Å–ª–∏ –¥–ª—è –æ–¥–Ω–æ–≥–æ –∫–ª—é—á–∞ –ø—Ä–∏—Ö–æ–¥–∏—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–ø–∏—Å–µ–π –∑–∞ –¥–µ–Ω—å ‚Äî —Å—É–º–º–∏—Ä—É–µ–º `updSum`
- **–ö–æ–ª–æ–Ω–∫–∏ –≤ –ë–î**:
  - `seller_advert_date_key`, `seller_id`, `advertId`, `campName`, `advertType`, `paymentType`
  - `advertStatus`, `updNum`, `updTime` (–¥–∞—Ç–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ YYYY-MM-DD –∏–ª–∏ –ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞), `updSum`

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ–ª–ª–µ—Ä–æ–≤

- SQL-–∑–∞–ø—Ä–æ—Å –±–µ—Ä—ë—Ç `ad_expenses_status`, `wb_api_key`, `wb_api_brand` –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∫–ª–∞–º–Ω—ã—Ö –∫–∞–º–ø–∞–Ω–∏–π (`campaigns_cnt`) –∏–∑ `WB_ad_campaigns`.
- **–õ–æ–≥–∏–∫–∞ —Å—Ç–∞—Ç—É—Å–æ–≤** (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ ad stats):
  - `new` ‚Äî —Å–µ–ª–ª–µ—Ä –±–µ–∑ —Å—Ç–∞—Ç—É—Å–∞, –≤—ã–≥—Ä—É–∂–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ 15 –¥–Ω–µ–π, –ø—Ä–∏—Å–≤–∞–∏–≤–∞–µ–º `left`
  - `left` ‚Äî –Ω–æ–≤–∏—á–æ–∫, –∫–æ–ø–∞–µ–º –≤ –≥–ª—É–±–∏–Ω—É –¥–æ 180 –¥–Ω–µ–π –Ω–∞–∑–∞–¥ –æ—Ç —Å–µ–≥–æ–¥–Ω—è
  - `right` ‚Äî —Å–µ–ª–ª–µ—Ä –ø—Ä–æ—à—ë–ª –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–¥–≤–∏–≥–∞–µ–º—Å—è –≤–ø–µ—Ä—ë–¥)
- **–ö—É–ª–¥–∞—É–Ω—ã**:
  - `new` ‚Äî —Å—Ä–∞–∑—É
  - `left` ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π `nowTime` –∏–∑ –≥—Ä—É–ø–ø—ã
  - `right` ‚Äî **30 –º–∏–Ω—É—Ç** (`AD_EXPENSES_RIGHT_COOLDOWN_MINUTES = 30`)
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å**: –µ—Å–ª–∏ —É —Å–µ–ª–ª–µ—Ä–∞ 0 —Ä–µ–∫–ª–∞–º–Ω—ã—Ö –∫–∞–º–ø–∞–Ω–∏–π (`campaigns_cnt = 0`) –∏ –Ω–µ—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ ‚Äî —Å—Ä–∞–∑—É —Å—Ç–∞–≤–∏–º —Å—Ç–∞—Ç—É—Å `right` (–Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º)
- Telegram –ø–æ–ª—É—á–∞–µ—Ç —Å–≤–æ–¥–∫—É —Å:
  - –ú–∏–Ω—É—Ç–∞–º–∏ —Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ø—Ä–æ–≥–æ–Ω–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `28min |`)
  - –ì—Ä–∞–Ω–∏—Ü–∞–º–∏ –¥–∞—Ç –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `05.11.25 - 13.11.25`)
  - **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –†–ö** (–Ω–∞–ø—Ä–∏–º–µ—Ä, `350 | BOONI`)
  - –û—Ç–º–µ—Ç–∫–∞–º–∏ –¥–æ–ø—É—Å–∫–∞ (‚úÖ/‚úñÔ∏è)

### 2. –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤

- –î–∏–∞–ø–∞–∑–æ–Ω: –º–∞–∫—Å–∏–º—É–º 180 –¥–Ω–µ–π –Ω–∞–∑–∞–¥, –∏–Ω—Ç–µ—Ä–≤–∞–ª ‚Äî –¥–æ 30 –¥–Ω–µ–π –≤–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ (`AD_EXPENSES_MAX_INTERVAL_DAYS = 30`).
- –ò–Ω—Ç–µ—Ä–≤–∞–ª—ã —Ä–∞–∑–±–∏–≤–∞—é—Ç—Å—è –Ω–∞ —á–∞–Ω–∫–∏ –ø–æ 30 –¥–Ω–µ–π.
- **Rate limiting**: **1 –∑–∞–ø—Ä–æ—Å –≤ —Å–µ–∫—É–Ω–¥—É** (`AD_EXPENSES_RATE_INTERVAL_SECONDS = 1`).
- **–ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É —á–∞–Ω–∫–∞–º–∏**: 2 —Å–µ–∫—É–Ω–¥—ã (`AD_EXPENSES_CHUNK_DELAY_SECONDS = 2`).
- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã: `new` > `left` (–æ–¥–∏–Ω —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º `nowTime`) > `right` (–≤—Å–µ, –µ—Å–ª–∏ –≤—Å–µ —Å–µ–ª–ª–µ—Ä—ã right).
- –í Telegram –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Ä–µ–∑—é–º–µ —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –†–ö –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ–ª–ª–µ—Ä–∞.

### 3. –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤

- –ó–∞–ø—Ä–æ—Å: `GET https://advert-api.wildberries.ru/adv/v1/upd` —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ `from` (beginDate) –∏ `to` (endDate).
- –ü–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º –±–æ—Ç –∂–¥—ë—Ç 1 —Å–µ–∫—É–Ω–¥—É –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏ –∏ 2 —Å–µ–∫—É–Ω–¥—ã –º–µ–∂–¥—É —á–∞–Ω–∫–∞–º–∏.
- **–†–µ—Ç—Ä–∞–∏**: –¥–æ 5 –ø–æ–ø—ã—Ç–æ–∫ –¥–ª—è –æ—à–∏–±–æ–∫ 429/500 —Å –Ω–∞—Ä–∞—Å—Ç–∞—é—â–µ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π (5, 10, 15, 20, 25 —Å–µ–∫) (`AD_EXPENSES_MAX_RETRIES = 5`, `AD_EXPENSES_RETRY_BASE_DELAY_SECONDS = 5`).
- –†–µ–∑—É–ª—å—Ç–∞—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è:
  - –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –∫–ª—é—á—É `seller_id + advertId + date + paymentType`
  - –ê–≥—Ä–µ–≥–∞—Ü–∏—è `updSum` –¥–ª—è –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –∫–ª—é—á–µ–π
  - –û–±—Ä–∞–±–æ—Ç–∫–∞ `updTime`: –µ—Å–ª–∏ `null` ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É, –∏–Ω–∞—á–µ —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–ª—å–∫–æ –¥–∞—Ç—É (YYYY-MM-DD)
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞**: –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫ `[WB-bot] Ad Expenses: –∑–∞–ø—Ä–æ—Å X/Y | brand | –∏–Ω—Ç–µ—Ä–≤–∞–ª...`
- –û—à–∏–±–∫–∏ –∞–∫–∫—É–º—É–ª–∏—Ä—É—é—Ç—Å—è –∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º.

### 4. CSV –∏ –∑–∞–≥—Ä—É–∑–∫–∞ –≤ –ë–î

- –ü–∏—à–µ–º `WB_ad_expenses_import.csv` —Å –∫–æ–ª–æ–Ω–∫–∞–º–∏ (–≤ –ø–æ—Ä—è–¥–∫–µ!):
  - `seller_advert_date_key`, `seller_id`, `advertId`, `campName`, `advertType`, `paymentType`
  - `advertStatus`, `updNum`, `updTime`, `updSum`
- **LOAD DATA INFILE** –≤ `WB_ad_expenses` —Å –º–∞–ø–ø–∏–Ω–≥–æ–º –≤—Å–µ—Ö –ø–æ–ª–µ–π –∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–µ–π –ø—É—Å—Ç—ã—Ö —Å—Ç—Ä–æ–∫ –≤ `NULL`.
- ‚ö†Ô∏è **–ö–†–ò–¢–ò–ß–ù–û**: –°—Ç–∞—Ç—É—Å—ã –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è **–¢–û–õ–¨–ö–û** –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –≤ –ë–î. –ï—Å–ª–∏ –∑–∞–≥—Ä—É–∑–∫–∞ –Ω–µ –ø—Ä–æ—à–ª–∞ ‚Äî —Å—Ç–∞—Ç—É—Å—ã –ù–ï –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è.

### 5. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤

- **–õ–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫**:
  - –ï—Å–ª–∏ –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã —Å–µ–ª–ª–µ—Ä–∞ –≤–µ—Ä–Ω—É–ª–∏ –æ—à–∏–±–∫—É –æ—Ç WB ‚Äî —Å—Ç–∞—Ç—É—Å –ù–ï –º–µ–Ω—è–µ—Ç—Å—è (–æ—Å—Ç–∞–≤–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π)
  - –ï—Å–ª–∏ —É —Å–µ–ª–ª–µ—Ä–∞ 0 –†–ö –∏ –Ω–µ—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ ‚Äî —Å—Ç–∞—Ç—É—Å `right` (–Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º)
  - **–í–ê–ñ–ù–û**: –ü—É—Å—Ç–æ–π –æ—Ç–≤–µ—Ç –æ—Ç WB API (—É—Å–ø–µ—à–Ω—ã–π –∑–∞–ø—Ä–æ—Å, –Ω–æ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö) **–ù–ï –ø–µ—Ä–µ–≤–æ–¥–∏—Ç –Ω–æ–≤–∏—á–∫–∞ –≤ `right`** ‚Äî —ç—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–æ—Å—Ç–æ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Å–ø–∏—Å–∞–Ω–∏–π –∑–∞ –ø–µ—Ä–∏–æ–¥, —Å—Ç–∞—Ç—É—Å –æ—Å—Ç–∞—ë—Ç—Å—è `left`
- **–§–æ—Ä–º–∞—Ç —Å—Ç–∞—Ç—É—Å–∞**:
  ```json
  {
    "status": "left" | "right",
    "nowTime": "YYYY-MM-DD HH:MM:SS",
    "lastTotalRow": <–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫>,
    "leftBoundary": "YYYY-MM-DD",
    "maxBeginDate": "YYYY-MM-DD",
    "lastBeginDate": "YYYY-MM-DD",
    "rightBoundary": "YYYY-MM-DD"
  }
  ```
- **–í—ã—á–∏—Å–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞**:
  - `maxBeginDate` = min(—Å—Ç–∞—Ä—ã–π `maxBeginDate`, —Ç–µ–∫—É—â–∏–π `beginDate` –∏–∑ —É—Å–ø–µ—à–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤)
  - `leftBoundary` / `rightBoundary` = –º–∏–Ω/–º–∞–∫—Å –¥–∞—Ç—ã –∏–∑ –ø–æ–ª—è `updTime` –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —Å—Ç—Ä–æ–∫
  - `status` = `right` –µ—Å–ª–∏ —Å—Ç–∞—Ä—ã–π —É–∂–µ `right` –ò–õ–ò —Ç–µ–∫—É—â–∏–π `beginDate` <= (—Å–µ–≥–æ–¥–Ω—è - 180 –¥–Ω–µ–π)
  - –î–ª—è –Ω–æ–≤–∏—á–∫–æ–≤ (`prev == None`): –≤—Å–µ–≥–¥–∞ `left`, –¥–∞–∂–µ –ø—Ä–∏ –ø—É—Å—Ç–æ–º –æ—Ç–≤–µ—Ç–µ
- Telegram-—Å–≤–æ–¥–∫–∞ –ø–æ –∏—Ç–æ–≥–∞–º: —Å–∫–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫ —Å–ø–∏—Å–∞–Ω–∏–π –ø–æ –∫–∞–∂–¥–æ–º—É –±—Ä–µ–Ω–¥—É, –ø–µ—Ä–µ—Ö–æ–¥—ã —Å—Ç–∞—Ç—É—Å–æ–≤.

---

## ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–´–ï –ú–û–ú–ï–ù–¢–´

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –±–∞–≥–∏ –∏ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

1. **WB_ad_stats: –∏–º–µ–Ω–∞ –∫–æ–ª–æ–Ω–æ–∫ –≤ –ë–î (snake_case)**
   - `advert_id` (–ù–ï `advertId` –≤ LOAD DATA INFILE)
   - `app_type` (–ù–ï `appType` –≤ LOAD DATA INFILE)
   - `nmID` (—Å –±–æ–ª—å—à–æ–π D, –Ω–µ `nmId`)
   - –í CSV –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è camelCase –∏–º–µ–Ω–∞ (`advertId`, `appType`, `nmId`), –Ω–æ –≤ LOAD DATA INFILE –º–∞–ø–ø—è—Ç—Å—è –Ω–∞ snake_case –∏–º–µ–Ω–∞ –ë–î

2. **–°—Ç–∞—Ç—É—Å—ã –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –¢–û–õ–¨–ö–û –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –≤ –ë–î**
   - –ï—Å–ª–∏ `LOAD DATA INFILE` —É–ø–∞–ª —Å –æ—à–∏–±–∫–æ–π ‚Äî —Å—Ç–∞—Ç—É—Å—ã –ù–ï –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è
   - –≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö –∏ —Å—Ç–∞—Ç—É—Å–æ–≤

3. **–ù–µ—Ç —Å—Ç–∞—Ç—É—Å–∞ `true` ‚Äî —Ç–æ–ª—å–∫–æ `left` –∏ `right`**
   - `left` = –Ω–æ–≤–∏—á–æ–∫, –∫–æ–ø–∞–µ–º –≤ –≥–ª—É–±–∏–Ω—É (–¥–æ 180 –¥–Ω–µ–π –Ω–∞–∑–∞–¥)
   - `right` = —à—Ç–∞—Ç–Ω—ã–π —Ä–µ–∂–∏–º, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–¥–≤–∏–≥–∞–µ–º—Å—è –≤–ø–µ—Ä—ë–¥)
   - –¶–µ–ª—å: –±—ã—Å—Ç—Ä–æ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–ª—è –Ω–æ–≤–∏—á–∫–æ–≤, –∑–∞—Ç–µ–º –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å

4. **–°–µ–ª–ª–µ—Ä—ã –±–µ–∑ —Ä–µ–∫–ª–∞–º–Ω—ã—Ö –∫–∞–º–ø–∞–Ω–∏–π (0 –†–ö)**
   - –ï—Å–ª–∏ —É —Å–µ–ª–ª–µ—Ä–∞ –Ω–µ—Ç –∫–∞–º–ø–∞–Ω–∏–π ‚Äî —Å—Ä–∞–∑—É —Å—Ç–∞–≤–∏–º —Å—Ç–∞—Ç—É—Å `right`
   - –ù–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∏—Ö –≤ —Å–ª–µ–¥—É—é—â–∏—Ö —Ü–∏–∫–ª–∞—Ö –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è –∫—É–ª–¥–∞—É–Ω–∞ (30 –º–∏–Ω—É—Ç)

5. **–ö—É–ª–¥–∞—É–Ω –¥–ª—è `right` —Å—Ç–∞—Ç—É—Å–∞: 30 –º–∏–Ω—É—Ç**
   - `AD_STATS_RIGHT_COOLDOWN_MINUTES = 30`
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –¥—Ä—É–≥–∏—Ö –≥—Ä—É–ø–ø (`new`, `left`)

6. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞**
   - –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å ad stats –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è: `[WB-bot] Ad Stats: –∑–∞–ø—Ä–æ—Å X/Y | brand | chunk...`
   - –ü–æ–º–æ–≥–∞–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

7. **–†–µ—Ç—Ä–∞–∏ –¥–ª—è –æ—à–∏–±–æ–∫ 429/500**
   - –î–æ 5 –ø–æ–ø—ã—Ç–æ–∫ —Å –Ω–∞—Ä–∞—Å—Ç–∞—é—â–µ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π (30, 60, 90, 120, 150 —Å–µ–∫)
   - –ï—Å–ª–∏ –≤—Å–µ –ø–æ–ø—ã—Ç–∫–∏ –∏—Å—á–µ—Ä–ø–∞–Ω—ã ‚Äî –∑–∞–ø—Ä–æ—Å —Å—á–∏—Ç–∞–µ—Ç—Å—è –Ω–µ—É–¥–∞—á–Ω—ã–º

8. **WB_ad_expenses: –ø—É—Å—Ç–æ–π –æ—Ç–≤–µ—Ç –Ω–µ –ø–µ—Ä–µ–≤–æ–¥–∏—Ç –Ω–æ–≤–∏—á–∫–∞ –≤ right**
   - –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å—ã —É—Å–ø–µ—à–Ω—ã, –Ω–æ –≤–µ—Ä–Ω—É–ª–∏ –ø—É—Å—Ç–æ–π –æ—Ç–≤–µ—Ç (–Ω–µ—Ç —Å–ø–∏—Å–∞–Ω–∏–π –∑–∞ –ø–µ—Ä–∏–æ–¥) ‚Äî —ç—Ç–æ –Ω–µ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ –≤—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–æ–±—Ä–∞–Ω—ã
   - –î–ª—è –Ω–æ–≤–∏—á–∫–æ–≤ (`new`/`left`) –ø—É—Å—Ç–æ–π –æ—Ç–≤–µ—Ç –æ—Å—Ç–∞–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å `left`, —Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è
   - –°—Ç–∞—Ç—É—Å `right` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏: —Å—Ç–∞—Ä—ã–π —Å—Ç–∞—Ç—É—Å —É–∂–µ –±—ã–ª `right` –ò–õ–ò —Ç–µ–∫—É—â–∏–π `beginDate` <= (—Å–µ–≥–æ–¥–Ω—è - 180 –¥–Ω–µ–π)

9. **WB_ad_expenses: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –†–ö –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏ Telegram**
   - –í —Å–≤–æ–¥–∫–µ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∫–ª–∞–º–Ω—ã—Ö –∫–∞–º–ø–∞–Ω–∏–π (`campaigns_cnt`) –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ–ª–ª–µ—Ä–∞
   - –§–æ—Ä–º–∞—Ç: `28min | right | 05.11.25 - 13.11.25 | 350 | BOONI ‚úñÔ∏è`
   - –ü–æ–º–æ–≥–∞–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å, —Å–∫–æ–ª—å–∫–æ –†–ö –≤–∏–¥–∏—Ç –±–æ—Ç –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ–ª–ª–µ—Ä–∞

10. **WB_ad_expenses: –∞–≥—Ä–µ–≥–∞—Ü–∏—è updSum**
    - –ï—Å–ª–∏ –¥–ª—è –æ–¥–Ω–æ–≥–æ –∫–ª—é—á–∞ (`seller_id + advertId + date + paymentType`) –ø—Ä–∏—Ö–æ–¥–∏—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–ø–∏—Å–µ–π ‚Äî —Å—É–º–º–∏—Ä—É–µ–º `updSum`
    - –≠—Ç–æ –≤–∞–∂–Ω–æ, —Ç–∞–∫ –∫–∞–∫ WB –º–æ–∂–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–ø–∏—Å–µ–π –∑–∞ –æ–¥–∏–Ω –¥–µ–Ω—å –¥–ª—è –æ–¥–Ω–æ–π –∫–∞–º–ø–∞–Ω–∏–∏

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

- **–£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–ª—é—á WB_ad_stats**: `seller_advert_date_key` = `seller_id_advert_id_nmId_date_appType`
- **–£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–ª—é—á WB_ad_expenses**: `seller_advert_date_key` = `seller_id_advertId_date_paymentType`
- **CSV –∫–æ–ª–æ–Ω–∫–∏**: –ø–æ—Ä—è–¥–æ–∫ –≤–∞–∂–µ–Ω –¥–ª—è LOAD DATA INFILE
- **–£–¥–∞–ª–µ–Ω—ã –∏–∑ —Ç–∞–±–ª–∏—Ü—ã**: `brand`, `name` ‚Äî –∏—Ö –Ω–µ—Ç –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –ë–î

### –ß–∞—Å—Ç–æ—Ç–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

- –ë–æ—Ç –≤—ã–ø–æ–ª–Ω—è–µ—Ç –æ–¥–∏–Ω –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª (01‚Üí02‚Üí03‚Üí04‚Üí05‚Üí06)
- –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∂–¥—ë—Ç 5 –º–∏–Ω—É—Ç (`time.sleep(300)`)
- –ó–∞—Ç–µ–º –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è, Docker –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä (`restart: unless-stopped`)
- –§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –∏–Ω—Ç–µ—Ä–≤–∞–ª –º–µ–∂–¥—É —Ü–∏–∫–ª–∞–º–∏: ~5 –º–∏–Ω—É—Ç + –≤—Ä–µ–º—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞

### Telegram-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

- –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –≤–æ—Ä–∫—Ñ–ª–æ—É: –ø–∞—É–∑–∞ 2 —Å–µ–∫—É–Ω–¥—ã (`time.sleep(2)`) –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –ª–∏–º–∏—Ç–æ–≤ Telegram API
- –í—Å–µ –æ—à–∏–±–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
- –°–≤–æ–¥–∫–∏ –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

---

## –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –≤–æ—Ä–∫—Ñ–ª–æ—É

1. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–∞–±–ª–∏—Ü—ã –∏ —Å—Ç–∞—Ç—É—Å –≤ `WB_sellers_updates`.
2. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É ¬´–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ ‚Üí –∑–∞–ø—Ä–æ—Å ‚Üí CSV ‚Üí –∑–∞–≥—Ä—É–∑–∫–∞ ‚Üí —Å—Ç–∞—Ç—É—Å¬ª.
3. –ù–µ –∑–∞–±—ã—Ç—å –ø—Ä–æ:
   - Telegram-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
   - –ö—É–ª–¥–∞—É–Ω—ã (–æ—Å–æ–±–µ–Ω–Ω–æ –¥–ª—è `right` —Å—Ç–∞—Ç—É—Å–∞)
   - –ü–∞—É–∑—É 2 —Å–µ–∫ –º–µ–∂–¥—É –≤–æ—Ä–∫—Ñ–ª–æ—É
   - –ü—Ä–æ–≤–µ—Ä–∫—É —É—Å–ø–µ—à–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –ø–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º —Å—Ç–∞—Ç—É—Å–æ–≤
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –¥–ª—è –¥–ª–∏—Ç–µ–ª—å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∏–º—ë–Ω –∫–æ–ª–æ–Ω–æ–∫ –≤ CSV –∏ –ë–î (snake_case vs camelCase).

